<!DOCTYPE html>
<html lang="zh-CN">

  
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  
  
  <title>Hive入门 | shaohua&#39;s blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="大数据,Hive,">
  

  <script type="text/javascript">
	$(document).ready(function() {
	    //为超链接加上target='_blank'属性
		$('a[href^="http"]').each(function() {
			$(this).attr('target', '_blank');
		});
	});
  </script>

  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/icon/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">

  <script src="/js/util.js"></script>
<script src="/js/valine.min.js"></script>

  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  

</head>

  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/">Fenghuayangyi</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a href="/" target="_self">
              主页
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a href="/archives/" target="_self">
              归档
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            <a href="/categories/" target="_self">
              分类
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            <a href="/tags/" target="_self">
              标签
            </a>
          
        </li>
      
        <li class="nav-item" data-path>
          
            <a href="javascript:void(0);" v-else>抓到我</a>
            <ul class="nav-menu--dropdown">
              
                <li>
                  <a href="https://github.com/fenghuayangyi" target="_blank">
                    Github
                  </a>
                </li>
              
                <li>
                  <a href="https://blog.csdn.net/u011295626" target="_blank">
                    CSDN
                  </a>
                </li>
              
            </ul>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>Hive入门</span>
  </h1>
  <div class="article-top-meta">
    <span>
      发布 : 
      2019-04-22
    </span>
    
      <span>
        分类 : 
          <a href="/categories/大数据/">
            大数据
          </a>
      </span>
    
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <h1 id="1-Hive的基本概念"><a href="#1-Hive的基本概念" class="headerlink" title="1. Hive的基本概念"></a>1. Hive的基本概念</h1><h2 id="1-1-什么是Hive"><a href="#1-1-什么是Hive" class="headerlink" title="1.1 什么是Hive"></a>1.1 什么是Hive</h2><p>Hive是基于Hadoop的一个数据仓库工具，将<strong>结构化的数据文件映射为一张表，并提供类SQL查询功能</strong>。</p>
<ul>
<li><strong>本质是：将HQL转化成MapReduce程序</strong><ul>
<li>Hive处理的数据存储在HDFS</li>
<li>Hive分析数据底层的实现是MapReduce</li>
<li>执行程序运行在YARN上</li>
</ul>
</li>
</ul>
<h2 id="1-2-Hive的好处"><a href="#1-2-Hive的好处" class="headerlink" title="1.2 Hive的好处"></a>1.2 Hive的好处</h2><ol>
<li>操作接口采用类SQL语法，提供快速开发的能力。</li>
<li>避免了去写MapReduce，减少开发人员的学习成本。</li>
<li>扩展功能很方便。</li>
</ol>
<h2 id="1-3-Hive架构原理"><a href="#1-3-Hive架构原理" class="headerlink" title="1.3 Hive架构原理"></a>1.3 Hive架构原理</h2><p><img src="http://ww1.sinaimg.cn/large/a3a0cfd7ly1g7nmb958ryj20b50addg3.jpg" alt="Hive架构.jpg"></p>
<p>Hive通过给用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的Driver，结合元数据(MetaStore)，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将执行返回的结果输出到用户交互接口。</p>
<p>1）用户接口：Client</p>
<p>​    CLI（hive shell）、JDBC/ODBC(java访问hive)、WEBUI（浏览器访问hive）</p>
<p>2）元数据：Metastore</p>
<p>​    元数据包括：表名、表所属的数据库（默认是default）、表的拥有者、列/分区字段、表的类型（是否是外部表）、表的数据所在目录等；</p>
<p>默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore</p>
<p>3）Hadoop</p>
<p>​    使用HDFS进行存储，使用MapReduce进行计算。</p>
<p>4）驱动器：Driver</p>
<p>​    （1）解析器（SQL Parser）：将SQL字符串转换成抽象语法树AST，这一步一般都用第三方工具库完成，比如antlr；对AST进行语法分析，比如表是否存在、字段是否存在、SQL语义是否有误。</p>
<p>​    （2）编译器（Physical Plan）：将AST编译生成逻辑执行计划。</p>
<p>​    （3）优化器（Query Optimizer）：对逻辑执行计划进行优化。</p>
<p>​    （4）执行器（Execution）：把逻辑执行计划转换成可以运行的物理计划。对于Hive来说，就是MR/TEZ/Spark。</p>
<h2 id="1-4-Hive的特点"><a href="#1-4-Hive的特点" class="headerlink" title="1.4 Hive的特点"></a>1.4 Hive的特点</h2><p>1）操作接口采用类SQL语法，提供快速开发的能力（简单、容易上手）</p>
<p>2）避免了去写MapReduce，减少开发人员的学习成本。</p>
<p>3）Hive的执行延迟比较高，因此hive常用于数据分析，对实时性要求不高的场合；</p>
<p>4）Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较高。</p>
<p>5）Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</p>
<p><strong>PS : Hive 和数据库除了拥有类似的查询语言，再无类似之处。</strong></p>
<p>6)   由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。<strong>因此，Hive中不支持对数据的改写和添加，所有的数据都是在加载的时候中确定好的。</strong></p>
<p>7)   Hive要访问数据中满足条件的特定值时，需要暴力扫描整个数据，因此访问延迟较高。由于 MapReduce 的引入， Hive 可以并行访问数据，因此即使没有索引，对于大数据量的访问，Hive 仍然可以体现出优势。</p>
<h1 id="2-Hive常用命令"><a href="#2-Hive常用命令" class="headerlink" title="2. Hive常用命令"></a>2. Hive常用命令</h1><h2 id="2-1-Hive常用交互命令"><a href="#2-1-Hive常用交互命令" class="headerlink" title="2.1 Hive常用交互命令"></a>2.1 Hive常用交互命令</h2><ol>
<li><p>bin/hive -e “select id from student;”     不进入hive的交互窗口执行sql语句</p>
</li>
<li><p>bin/hive -f /opt/module/datas/hivef.sql    执行hivef.sql脚本中sql语句</p>
</li>
<li><p>bin/hive -f /opt/module/datas/hivef.sql  &gt; /opt/module/datas/hive_result.txt    </p>
<p>执行文件中的sql语句并将结果写入文件中</p>
</li>
</ol>
<h2 id="2-2-Hive其他命令操作"><a href="#2-2-Hive其他命令操作" class="headerlink" title="2.2 Hive其他命令操作"></a>2.2 Hive其他命令操作</h2><ol>
<li><p>退出hive窗口：exit; || quit;</p>
<p>exit:先隐性提交数据，再退出；</p>
<p>quit:不提交数据，退出；</p>
</li>
<li><p>dfs -ls /;    在hive cli命令窗口中如何查看hdfs文件系统</p>
</li>
<li><p>!ls /opt/module/datas;    在hive cli命令窗口中如何查看hdfs本地系统</p>
</li>
<li><p>查看在hive中输入的所有历史命令</p>
<ul>
<li>进入到当前用户的根目录cd </li>
<li>cat .hivehistory</li>
</ul>
</li>
</ol>
<h1 id="3-DDL数据定义"><a href="#3-DDL数据定义" class="headerlink" title="3. DDL数据定义"></a>3. DDL数据定义</h1><h2 id="3-1-创建数据库"><a href="#3-1-创建数据库" class="headerlink" title="3.1 创建数据库"></a>3.1 创建数据库</h2><ol>
<li><p>创建一个数据库，数据库在HDFS上的默认存储路径是/user/hive/warehouse/*.db。</p>
<p>create database db_hive;</p>
</li>
<li><p>避免要创建的数据库已经存在错误，增加if not exists判断。（标准写法）</p>
<p>create database if not exists db_hive;</p>
</li>
<li><p>创建一个数据库，指定数据库在HDFS上存放的位置</p>
<p>create database if not exists db_hive2 location ‘/db_hive2.db’;</p>
</li>
</ol>
<h2 id="3-2-修改数据库"><a href="#3-2-修改数据库" class="headerlink" title="3.2 修改数据库"></a>3.2 修改数据库</h2><p>用户可以使用ALTER DATABASE命令为某个数据库的DB PROPERTIES设置键-值对属性值，来描述这个数据库的属性信息。</p>
<p><strong>数据库的其他元数据信息都是不可更改的，包括数据库名和数据库所在的目录位置。</strong></p>
<p>alter database db_hive set dbproperties(‘createtime’=’20170830’);</p>
<h2 id="3-3-查询数据库"><a href="#3-3-查询数据库" class="headerlink" title="3.3 查询数据库"></a>3.3 查询数据库</h2><ol>
<li><p>显示数据库</p>
<p>show databases;</p>
<p>show databases like ‘db_hive*’;</p>
</li>
<li><p>查看数据库详情</p>
<p>desc database db_hive;</p>
<p>desc database extended db_hive;</p>
</li>
<li><p>使用数据库</p>
<p>use db_hive;</p>
</li>
</ol>
<h2 id="3-4-删除数据库"><a href="#3-4-删除数据库" class="headerlink" title="3.4 删除数据库"></a>3.4 删除数据库</h2><ol>
<li><p>删除空数据库</p>
<p>drop database db_hive2;</p>
</li>
<li><p>如果删除的数据库不存在，最好采用 if exists判断数据库是否存在</p>
<p>drop database if exists db_hive2;</p>
</li>
<li><p>如果数据库不为空，可以采用cascade命令，强制删除</p>
<p>drop database db_hive cascade;</p>
</li>
</ol>
<h2 id="3-5-创建表"><a href="#3-5-创建表" class="headerlink" title="3.5 创建表"></a>3.5 创建表</h2><h3 id="3-5-1-建表语法"><a href="#3-5-1-建表语法" class="headerlink" title="3.5.1 建表语法"></a>3.5.1 建表语法</h3>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name </span><br><span class="line">[(col_name data_type [COMMENT col_comment], ...)] </span><br><span class="line">[COMMENT table_comment] </span><br><span class="line">[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] </span><br><span class="line">[CLUSTERED BY (col_name, col_name, ...) </span><br><span class="line">[SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] </span><br><span class="line">[ROW FORMAT row_format] </span><br><span class="line">[STORED AS file_format] </span><br><span class="line">[LOCATION hdfs_path]</span><br></pre></td></tr></table></figure>
<h3 id="3-5-2-管理表"><a href="#3-5-2-管理表" class="headerlink" title="3.5.2 管理表"></a>3.5.2 管理表</h3><p>   默认创建的表都是所谓的管理表，有时也被称为内部表。</p>
<p>   Hive默认情况下会将这些表的数据存储在由配置项hive.metastore.warehouse.dir(例如，/user/hive/warehouse)所定义的目录的子目录下。    </p>
<p>   当我们删除一个管理表时，Hive也会删除这个表中数据。管理表不适合和其他工具共享数据。</p>
<ul>
<li><p>普通创建表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student2(</span><br><span class="line">id int, name string</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &apos;\t&apos;</span><br><span class="line">stored as textfile</span><br><span class="line">location &apos;/user/hive/warehouse/student2&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据查询结果创建表（查询的结果会添加到新创建的表中）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student3</span><br><span class="line">as select id, name from student;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据已经存在的表结构创建表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student4 like student;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询表的类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc formatted student2</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-5-3-外部表"><a href="#3-5-3-外部表" class="headerlink" title="3.5.3 外部表"></a>3.5.3 外部表</h3><p>因为表是外部表，所有Hive并非认为其完全拥有这份数据。删除该表并不会删除掉这份数据，不过描述表的元数据信息会被删除掉。</p>
<ul>
<li><p>管理表和外部表的使用场景</p>
<p>每天将收集到的网站日志定期流入HDFS文本文件。</p>
<p>在外部表（原始日志表）的基础上做大量的统计分析，用到的中间表、结果表使用内部表存储，数据通过SELECT+INSERT进入内部表。</p>
</li>
<li><p>案例实操</p>
<p>分别创建部门和员工外部表，并向表中导入数据。（dept.txt, emp.txt）</p>
<ol>
<li><p>建表语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//部门表</span><br><span class="line">create external table if not exists default.dept(</span><br><span class="line">deptno int,</span><br><span class="line">dname string,</span><br><span class="line">loc int</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &apos;\t&apos;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//员工表</span><br><span class="line">create external table if not exists default.emp(</span><br><span class="line">empno int,</span><br><span class="line">ename string,</span><br><span class="line">job string,</span><br><span class="line">mgr int,</span><br><span class="line">hiredate string, </span><br><span class="line">sal double, </span><br><span class="line">comm double,</span><br><span class="line">deptno int)</span><br><span class="line">row format delimited fields terminated by &apos;\t&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看创建的表</p>
<p>show tables;</p>
</li>
<li><p>向外部表中导入数据</p>
<ul>
<li><p>导入数据</p>
<p> load data local inpath ‘/opt/module/datas/dept.txt’ into table default.dept;</p>
<p>load data local inpath ‘/opt/module/datas/emp.txt’ into table default.emp;</p>
</li>
<li><p>查询结果</p>
<p>select * from emp;</p>
<p>select * from dept;</p>
</li>
</ul>
</li>
<li><p>查看表数据</p>
<p> desc formatted dept;</p>
</li>
</ol>
</li>
</ul>
<h2 id="3-6-分区表"><a href="#3-6-分区表" class="headerlink" title="3.6 分区表"></a>3.6 分区表</h2><p>分区表实际上就是对应一个HDFS文件系统上的独立的文件夹，该文件夹下是该分区所有的数据文件。</p>
<p>Hive中的分区就是分目录，把一个大的数据集根据业务需要分割成小的数据集。</p>
<p>在查询时通过WHERE子句中的表达式选择查询所需要的指定的分区，这样的查询效率会提高很多。</p>
<h3 id="3-6-1-分区表基本操作"><a href="#3-6-1-分区表基本操作" class="headerlink" title="3.6.1 分区表基本操作"></a>3.6.1 分区表基本操作</h3><p>…</p>
<h3 id="3-6-2-分区表注意事项"><a href="#3-6-2-分区表注意事项" class="headerlink" title="3.6.2 分区表注意事项"></a>3.6.2 分区表注意事项</h3><p>…</p>
<h2 id="3-7-修改表"><a href="#3-7-修改表" class="headerlink" title="3.7 修改表"></a>3.7 修改表</h2><h3 id="3-7-1-表重命名"><a href="#3-7-1-表重命名" class="headerlink" title="3.7.1 表重命名"></a>3.7.1 表重命名</h3><ul>
<li><p>语法</p>
<p>ALTER TABLE table_name RENAME TO new_table_name</p>
</li>
<li><p>实例</p>
<p>alter table dept_partition2 rename to dept_partition3;</p>
</li>
</ul>
<h3 id="3-7-2-增加、修改和删除表分区"><a href="#3-7-2-增加、修改和删除表分区" class="headerlink" title="3.7.2 增加、修改和删除表分区"></a>3.7.2 增加、修改和删除表分区</h3><ul>
<li><p>语法</p>
<ol>
<li><p>更新列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment] [FIRST|AFTER column_name]</span><br></pre></td></tr></table></figure>
</li>
<li><p>增加和替换列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...)</span><br></pre></td></tr></table></figure>
<p>注：ADD是代表新增一字段，字段位置在所有列后面(partition列前)，REPLACE则是表示替换表中所有字段。</p>
</li>
</ol>
</li>
<li><p>实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 查询表结构</span><br><span class="line">   desc dept_partition;</span><br><span class="line">2. 添加列</span><br><span class="line">   alter table dept_partition add columns(deptdesc string);</span><br><span class="line">3. 查询表结构</span><br><span class="line">   desc dept_partition;</span><br><span class="line">4. 更新列</span><br><span class="line">   alter table dept_partition change column deptdesc desc int;</span><br><span class="line">5. 查询表结构</span><br><span class="line">   desc dept_partition;</span><br><span class="line">6. 替换列</span><br><span class="line">   alter table dept_partition replace columns(deptno string, dname string, loc string);</span><br><span class="line">7. 查询表结构</span><br><span class="line">   desc dept_partition;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-8-删除表"><a href="#3-8-删除表" class="headerlink" title="3.8 删除表"></a>3.8 删除表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table dept_partition;</span><br></pre></td></tr></table></figure>
<h1 id="4-DML数据操作"><a href="#4-DML数据操作" class="headerlink" title="4. DML数据操作"></a>4. DML数据操作</h1><h2 id="4-1-数据导入"><a href="#4-1-数据导入" class="headerlink" title="4.1 数据导入"></a>4.1 数据导入</h2><h3 id="4-1-1-向表中装载数据（Load）"><a href="#4-1-1-向表中装载数据（Load）" class="headerlink" title="4.1.1 向表中装载数据（Load）"></a>4.1.1 向表中装载数据（Load）</h3><p>1) 语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data [local] inpath &apos;/opt/module/datas/student.txt&apos; [overwrite] into table student [partition (partcol1=val1,…)];</span><br></pre></td></tr></table></figure>
<p>（1）load data:表示加载数据</p>
<p>（2）local:表示从本地加载数据到hive表；否则从HDFS加载数据到hive表</p>
<p>（3）inpath:表示加载数据的路径</p>
<p>（4）into table:表示加载到哪张表</p>
<p>（5）student:表示具体的表</p>
<p>（6）overwrite:表示覆盖表中已有数据，否则表示追加</p>
<p>（7）partition:表示上传到指定分区</p>
<p>2）实操案例</p>
<ol>
<li><p>创建一张表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table student(id string, name string) row format delimited fields terminated by &apos;\t&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载本地文件到hive</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &apos;/opt/module/datas/student.txt&apos; into table default.student;</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载HDFS文件到hive中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//上传文件到HDFS</span><br><span class="line">dfs -put /opt/module/datas/student.txt /user/hive;</span><br><span class="line">//加载HDFS上数据</span><br><span class="line">load data inpath &apos;/user/hive/student.txt&apos; into table default.student;</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载数据覆盖表中已有的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//上传文件到HDFS</span><br><span class="line">dfs -put /opt/module/datas/student.txt /user/hive;</span><br><span class="line">//加载数据覆盖表中已有的数据</span><br><span class="line">load data inpath &apos;/user/atguigu/hive/student.txt&apos; overwrite into table default.student;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-1-2-通过查询语句向表中插入数据（Insert）"><a href="#4-1-2-通过查询语句向表中插入数据（Insert）" class="headerlink" title="4.1.2 通过查询语句向表中插入数据（Insert）"></a>4.1.2 通过查询语句向表中插入数据（Insert）</h3><ol>
<li><p>创建一张分区表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table student(id string, name string) partitioned by (month string) row format delimited fields terminated by &apos;\t&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>基本插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into table student partition(month=&apos;201709&apos;) values(&apos;1004&apos;,&apos;wangwu&apos;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>基本模式插入（根据单张表查询结果）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite table student partition(month=&apos;201708&apos;)</span><br><span class="line">select id, name from student where month=&apos;201709&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多插入模式（根据多张表查询结果）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from student</span><br><span class="line">insert overwrite table student partition(month=&apos;201707&apos;)</span><br><span class="line">select id, name where month=&apos;201709&apos;</span><br><span class="line">insert overwrite table student partition(month=&apos;201706&apos;)</span><br><span class="line">select id, name where month=&apos;201709&apos;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-1-3-查询语句中创建表并加载数据（as-select）"><a href="#4-1-3-查询语句中创建表并加载数据（as-select）" class="headerlink" title="4.1.3 查询语句中创建表并加载数据（as select）"></a>4.1.3 查询语句中创建表并加载数据（as select）</h3><p>根据查询结果创建表（查询的结果会添加到新创建的表中）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student3</span><br><span class="line">as select id, name from student;</span><br></pre></td></tr></table></figure>
<h3 id="4-1-4-创建表时通过location指定加载数据路径"><a href="#4-1-4-创建表时通过location指定加载数据路径" class="headerlink" title="4.1.4 创建表时通过location指定加载数据路径"></a>4.1.4 创建表时通过location指定加载数据路径</h3><ol>
<li><p>创建表，<strong>并指定在hdfs上的位置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists student5(id int, name string)</span><br><span class="line">row format delimited fields terminated by &apos;\t&apos;</span><br><span class="line">location &apos;/user/hive/warehouse/student5&apos;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>上传数据到hdfs上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dfs -put /opt/module/datas/student.txt  /user/hive/warehouse/student5;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student5;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-1-5-import数据到指定hive表中"><a href="#4-1-5-import数据到指定hive表中" class="headerlink" title="4.1.5 import数据到指定hive表中"></a>4.1.5 import数据到指定hive表中</h3><p>先用export导出后，再将数据导入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import table student2 partition(month=&apos;201709&apos;) from &apos;/user/hive/warehouse/export/student&apos;;</span><br></pre></td></tr></table></figure>
<h2 id="4-2-数据导出"><a href="#4-2-数据导出" class="headerlink" title="4.2 数据导出"></a>4.2 数据导出</h2><h3 id="4-2-1-Insert-导出"><a href="#4-2-1-Insert-导出" class="headerlink" title="4.2.1 Insert 导出"></a>4.2.1 Insert 导出</h3><ol>
<li><p>将查询的结果导出到本地</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite local directory &apos;/opt/module/datas/export/student&apos;</span><br><span class="line">select * from student;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将查询的结果格式化导出到本地</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite local directory &apos;/opt/module/datas/export/student1&apos;</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY &apos;\t&apos; COLLECTION ITEMS TERMINATED BY &apos;\n&apos;</span><br><span class="line">select * from student;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将查询的<strong>结果导出到HDFS上</strong>(没有local)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite directory &apos;/user/atguigu/hive/warehouse/student2&apos;</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY &apos;\t&apos; COLLECTION ITEMS TERMINATED BY &apos;\n&apos;</span><br><span class="line">select * from student;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-Hadoop命令导出到本地"><a href="#4-2-2-Hadoop命令导出到本地" class="headerlink" title="4.2.2 Hadoop命令导出到本地"></a>4.2.2 Hadoop命令导出到本地</h3></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dfs -get /user/hive/warehouse/student/month=201709/000000_0  /opt/module/datas/export/student3.txt;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-3-Hive-Shell-命令导出"><a href="#4-2-3-Hive-Shell-命令导出" class="headerlink" title="4.2.3 Hive Shell 命令导出"></a>4.2.3 Hive Shell 命令导出</h3><p>基本语法：（hive -f/-e 执行语句或者脚本 &gt; file）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -e &apos;select * from default.student;&apos; &gt; /opt/module/datas/export/student4.txt;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-Export导出到HDFS上"><a href="#4-2-4-Export导出到HDFS上" class="headerlink" title="4.2.4 Export导出到HDFS上"></a>4.2.4 Export导出到HDFS上</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export table default.student to &apos;/user/hive/warehouse/export/student&apos;;</span><br></pre></td></tr></table></figure>
<h2 id="4-3-清除表中数据（Truncate）"><a href="#4-3-清除表中数据（Truncate）" class="headerlink" title="4.3 清除表中数据（Truncate）"></a>4.3 清除表中数据（Truncate）</h2><p>注意：Truncate只能删除管理表，不能删除外部表中数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate table student;</span><br></pre></td></tr></table></figure>
<h1 id="5-查询"><a href="#5-查询" class="headerlink" title="5. 查询"></a>5. 查询</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT [ALL | DISTINCT] select_expr, select_expr, ...</span><br><span class="line">  FROM table_reference</span><br><span class="line">  [WHERE where_condition]</span><br><span class="line">  [GROUP BY col_list]</span><br><span class="line">  [ORDER BY col_list]</span><br><span class="line">  [CLUSTER BY col_list</span><br><span class="line">    | [DISTRIBUTE BY col_list] [SORT BY col_list]</span><br><span class="line">  ]</span><br><span class="line"> [LIMIT number]</span><br></pre></td></tr></table></figure>
<h2 id="5-1-基本查询"><a href="#5-1-基本查询" class="headerlink" title="5.1 基本查询"></a>5.1 基本查询</h2><h3 id="5-1-1-全表和特定字段查询"><a href="#5-1-1-全表和特定字段查询" class="headerlink" title="5.1.1 全表和特定字段查询"></a>5.1.1 全表和特定字段查询</h3><ol>
<li><p>全表查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>选择特定列查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select empno, ename from emp;</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<p>（1）SQL 语言大小写不敏感。</p>
<p>（2）SQL 可以写在一行或者多行</p>
<p>（3）关键字不能被缩写也不能分行</p>
<p>（4）各子句一般要分行写。</p>
<p>（5）使用缩进提高语句的可读性。</p>
</li>
</ol>
<h3 id="5-1-2-列别名"><a href="#5-1-2-列别名" class="headerlink" title="5.1.2 列别名"></a>5.1.2 列别名</h3><p>别名紧跟列名，也可以在列名和别名之间加入关键字‘AS’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select ename AS name, deptno dn from emp;</span><br></pre></td></tr></table></figure>
<h3 id="5-1-3-算术运算符"><a href="#5-1-3-算术运算符" class="headerlink" title="5.1.3 算术运算符"></a>5.1.3 算术运算符</h3><table>
<thead>
<tr>
<th>A+B</th>
<th>A和B 相加</th>
</tr>
</thead>
<tbody>
<tr>
<td>A-B</td>
<td>A减去B</td>
</tr>
<tr>
<td>A*B</td>
<td>A和B 相乘</td>
</tr>
<tr>
<td>A/B</td>
<td>A除以B</td>
</tr>
<tr>
<td>A%B</td>
<td>A对B取余</td>
</tr>
<tr>
<td>A&amp;B</td>
<td>A和B按位取与</td>
</tr>
<tr>
<td>A\</td>
<td>B</td>
<td>A和B按位取或</td>
</tr>
<tr>
<td>A^B</td>
<td>A和B按位取异或</td>
</tr>
<tr>
<td>~A</td>
<td>A按位取反</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//实例</span><br><span class="line">select sal*0.8 from emp;</span><br></pre></td></tr></table></figure>
<h3 id="6-1-4-常用函数（聚合函数）"><a href="#6-1-4-常用函数（聚合函数）" class="headerlink" title="6.1.4 常用函数（聚合函数）"></a>6.1.4 常用函数（聚合函数）</h3><p>count(), max(), min(), sum(), avg();</p>
<h3 id="6-1-5-LIMIT语句"><a href="#6-1-5-LIMIT语句" class="headerlink" title="6.1.5 LIMIT语句"></a>6.1.5 LIMIT语句</h3><p>一般的查询会返回多行数据。LIMIT子句用于限制返回的行数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp limit 5;</span><br></pre></td></tr></table></figure>
<h2 id="5-2-Where-语句"><a href="#5-2-Where-语句" class="headerlink" title="5.2 Where 语句"></a>5.2 Where 语句</h2><p>…</p>
<h2 id="5-3-分组"><a href="#5-3-分组" class="headerlink" title="5.3 分组"></a>5.3 分组</h2><h3 id="5-3-1-GROUP-BY语句"><a href="#5-3-1-GROUP-BY语句" class="headerlink" title="5.3.1 GROUP BY语句"></a>5.3.1 GROUP BY语句</h3><p>GROUP BY语句通常会和聚合函数一起使用</p>
<ol>
<li><p>计算emp表每个部门的平均工资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select t.deptno, avg(t.sal) avg_sal from emp t group by t.deptno;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>计算emp每个部门中每个岗位的最高薪水</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select t.deptno, t.job, max(t.sal) max_sal from emp t group by t.deptno, t.job;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="5-3-2-HAVING语句"><a href="#5-3-2-HAVING语句" class="headerlink" title="5.3.2 HAVING语句"></a>5.3.2 HAVING语句</h3><ol>
<li><p>having与where不同点</p>
<ul>
<li>where针对表中的列发挥作用，查询数据；<strong>having针对查询结果中的列发挥作用</strong>，筛选数据。</li>
</ul>
</li>
</ol>
<ul>
<li>where后面不能写分组函数，而having后面可以使用分组函数。</li>
<li><strong>having只用于group by分组统计语句。</strong></li>
</ul>
<ol start="2">
<li><p>实例</p>
<ul>
<li><p>求每个部门的平均工资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select deptno, avg(sal) from emp group by deptno;</span><br></pre></td></tr></table></figure>
</li>
<li><p>求每个部门的平均薪水大于2000的部门</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select deptno, avg(sal) avg_sal from emp group by deptno having avg_sal &gt; 2000;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="5-4-JOIN-语句"><a href="#5-4-JOIN-语句" class="headerlink" title="5.4 JOIN 语句"></a>5.4 JOIN 语句</h2><h3 id="5-4-1-等值连接"><a href="#5-4-1-等值连接" class="headerlink" title="5.4.1 等值连接"></a>5.4.1 等值连接</h3><p>Hive支持通常的SQL JOIN语句，但是只支持等值连接，不支持非等值连接。</p>
<p>实例：根据员工表和部门表中的部门编号相等，查询员工编号、员工名称和部门编号；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select e.empno, e.ename, d.deptno, d.dname from emp e join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>
<h3 id="5-4-2-左外，右外连接"><a href="#5-4-2-左外，右外连接" class="headerlink" title="5.4.2 左外，右外连接"></a>5.4.2 左外，右外连接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//左外连接：JOIN操作符左边表中符合WHERE子句的所有记录将会被返回。</span><br><span class="line">select e.empno, e.ename, d.deptno from emp e left join dept d on e.deptno = d.deptno;</span><br><span class="line">//右外连接：JOIN操作符右边表中符合WHERE子句的所有记录将会被返回。</span><br><span class="line">select e.empno, e.ename, d.deptno from emp e right join dept d on e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>

    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          本文作者 : fenghuayangyi <br>
        
        原文链接 : <a href>https://github.com/fenghuayangyi/2019/04/22/Hive/</a><br>
        版权声明 : 本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。
        </blockquote>
      </div>
    </div>
  
  
  

  
    <div id="reward">
  
    <p id="reward-meta">知识 & 情怀 | 二者兼得</p>
  
  <button id="reward-btn">
    
    <span>投食</span>
  </button>
  <div id="reward-qrcode">
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/wechat.png" alt="微信扫一扫, 向我投食">
        <p class="qrcode-meta">微信扫一扫, 向我投食</p>
      </div>
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/alipay.png" alt="支付宝扫一扫, 向我投食">
        <p class="qrcode-meta">支付宝扫一扫, 向我投食</p>
      </div>
    
  </div>

</div>

<script>
  (() => {
    let button = document.querySelector('#reward-btn'),
      qrcode = document.querySelector('#reward-qrcode'),
      display = false;
    
    button.addEventListener('click', () => {
      qrcode.style.display = display ? 'none' : 'block'
      display = !display
    }, false)
  })()
</script>
  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>标签: 
          
          <span class="span--tag">
            <a href="/tags/Hive/">
              #Hive
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        上一篇:
        <a href="/2019/04/22/HiveSQL/" target="_self">HiveSQL</a>
      </div>
    
    
      <div class="nav-next">
        下一篇:
        <a href="/2019/05/19/scala/" target="_self">Scala入门</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

   

   

</div>


      <footer>
  <p class="site-info">
    博客已运行<span id="time-to-now"></span><span class="my-face">(●'◡'●)ﾉ♥</span>
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2018, 11, 10).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "天" + hour + "小时" + minute + "分钟" + second + "秒";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //关闭js加载过程信息
      messageStyle: "none", //不显示信息
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //可选字体
        showMathMenu: false //关闭右击菜单显示
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
